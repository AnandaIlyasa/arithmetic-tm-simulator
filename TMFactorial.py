import time
from TuringMachine import TuringMachine


class Factorial(TuringMachine):
    def user_input(self):
        num1 = int(input("Input number: "))
        if num1 < 0:
            print("Masukkan bilangan positif")
            return self.user_input()
        self.input_string = ""
        for i in range(abs(num1)):
            self.input_string += "0"
        return self.input_string


def start_machine():
    tm = Factorial(states={'q0', 'q1', 'q2', 'q3', 'q4', 'q5', 'q6', 'q7', 'q8', 'q9', 'q10', 'q11', 'q12', 'q13',
                           'q14', 'q15', 'q16', 'q17', 'q18', 'q19', 'q20', 'q21', 'q22', 'q23', 'q24', 'H'},
                   symbols={'0', '1', 'X', 'B'},
                   blank_symbol='B',
                   input_symbols={'0'},
                   initial_state='q0',
                   accepting_states={'H'},
                   transitions={
                       ('q0', '0'): ('q0', '0', 1),
                       ('q0', 'B'): ('q1', '1', -1),
                       ('q1', '1'): ('q1', '1', -1),
                       ('q1', '0'): ('q1', '0', -1),
                       ('q1', 'B'): ('q2', 'B', 1),
                       ('q2', '1'): ('q3', '1', 1),
                       ('q2', '0'): ('q7', 'X', 1),
                       ('q3', '0'): ('q3', '0', 1),
                       ('q3', 'B'): ('q4', '1', -1),
                       ('q4', '0'): ('q4', '0', -1),
                       ('q4', '1'): ('q4', '1', -1),
                       ('q4', 'X'): ('q4', '0', -1),
                       ('q4', 'B'): ('q5', 'B', 1),
                       ('q5', '0'): ('q6', 'B', 1),
                       ('q6', '1'): ('q15', '1', -1),
                       ('q6', '0'): ('q9', 'X', 1),
                       ('q7', '0'): ('q7', '0', 1),
                       ('q7', '1'): ('q7', '1', 1),
                       ('q7', 'B'): ('q8', '0', -1),
                       ('q8', '0'): ('q8', '0', -1),
                       ('q8', '1'): ('q8', '1', -1),
                       ('q8', 'X'): ('q2', 'X', 1),
                       ('q9', '0'): ('q9', '0', 1),
                       ('q9', '1'): ('q10', '1', 1),
                       ('q10', '0'): ('q13', 'X', 1),
                       ('q10', '1'): ('q11', '1', -1),
                       ('q11', 'X'): ('q11', '0', -1),
                       ('q11', '1'): ('q12', '1', -1),
                       ('q12', '1'): ('q12', '0', -1),
                       ('q12', '0'): ('q12', '0', -1),
                       ('q12', 'X'): ('q6', 'X', 1),
                       ('q13', '1'): ('q13', '1', 1),
                       ('q13', '0'): ('q13', '0', 1),
                       ('q13', 'B'): ('q14', '0', -1),
                       ('q14', '1'): ('q14', '1', -1),
                       ('q14', '0'): ('q14', '0', -1),
                       ('q14', 'X'): ('q10', 'X', 1),
                       ('q15', '1'): ('q15', '1', -1),
                       ('q15', '0'): ('q15', '0', -1),
                       ('q15', 'X'): ('q15', 'X', -1),
                       ('q15', 'B'): ('q16', 'B', 1),
                       ('q16', 'X'): ('q17', 'B', 1),
                       ('q16', '1'): ('q24', 'B', 1),
                       ('q17', '0'): ('q21', 'B', 1),
                       ('q17', '1'): ('q21', 'B', 1),
                       ('q17', 'X'): ('q20', 'X', 1),
                       ('q18', 'X'): ('q18', 'X', -1),
                       ('q18', '0'): ('q15', 'X', -1),
                       ('q18', '1'): ('q15', 'X', -1),
                       ('q19', '0'): ('q19', '0', 1),
                       ('q19', 'X'): ('q19', 'X', 1),
                       ('q19', '1'): ('q18', '1', -1),
                       ('q20', '0'): ('q20', '0', 1),
                       ('q20', 'X'): ('q20', 'X', 1),
                       ('q20', '1'): ('q19', '1', 1),
                       ('q21', '0'): ('q21', 'B', 1),
                       ('q21', 'X'): ('q22', 'X', 1),
                       ('q21', '1'): ('H', 'B', 1),
                       ('q22', '0'): ('q22', '0', 1),
                       ('q22', 'X'): ('q22', 'X', 1),
                       ('q22', '1'): ('q22', '1', 1),
                       ('q22', 'B'): ('q23', '1', -1),
                       ('q23', '0'): ('q23', '0', -1),
                       ('q23', 'X'): ('q23', '0', -1),
                       ('q23', '1'): ('q23', '1', -1),
                       ('q23', 'B'): ('q6', 'B', 1),
                       ('q24', '0'): ('q24', '0', 1),
                       ('q24', '1'): ('q24', 'B', 1),
                       ('q24', 'B'): ('H', 'B', 1),
                   })

    tm.initialize(dict(enumerate(tm.user_input())))

    while not tm.halted:
        tm.print()
        tm.step()
        time.sleep(1)

    tm.print_result()
